<script type="text/javascript">
	// <![CDATA[
		AUI().use('aui-base', () => {
			const frameElement = window.frameElement;

			if (
				frameElement &&
				frameElement.getAttribute('id') === 'simulationDeviceIframe'
			) {
				document.body.classList.add('lfr-has-simulation-panel');

				frameElement.onload = function () {
					const loadingIndicator = window.parent.document.getElementsByClassName(
						'loading-animation-simulation-device'
					)[0];

					if (loadingIndicator) {
						loadingIndicator.remove();
					}

					deviceWrapper.classList.remove('lfr-device--is-navigating');
				};

				const deviceWrapper = window.parent.document.getElementsByClassName(
					'lfr-device'
				)[0];

				Liferay.on('beforeNavigate', () => {
					const loadingIndicator = document.createElement('section');
					loadingIndicator.innerHTML = `
						<div class="loading-animation-simulation-device">
							<span aria-hidden="true" class="loading-animation"></span>
						<div>
					`;

					deviceWrapper.parentNode.appendChild(loadingIndicator);
					deviceWrapper.classList.add('lfr-device--is-navigating');
				});

					if (
						frameElement.contentWindow.location.href.includes(
							'p_l_mode=preview'
						)
					) {
						return;
					}

				const currentLocationHasParams = frameElement.contentWindow.location.href.includes(
				'?'
				);
				const safePreviewURL = `${frameElement.contentWindow.location.href}${
						currentLocationHasParams ? '&' : '?'
					}p_l_mode=preview`;

				frameElement.contentWindow.location.replace(safePreviewURL);
			}
		});
	//	]]>
</script>